type: task
name: train-cvgl-auto-batch-multi-gpu-gitclone

python: "3.11"

# Commands to run
commands:
  - git clone https://github.com/tavisshore/TACO.git .
  - git checkout get_graph_working
  - pip install -e .
  - pip install lightning wandb opencv-python albumentations timm tqdm
  - python examples/train_cvgl.py
    --batch-size 8
    --auto-batch-size
    --embedding-dim 512
    --learning-rate 0.0002
    --loss-type ntxent
    --scheduler-type cosine
    --max-epochs 40
    --model-name convnext
    --experiment-name auto-batch-multi-gpu-gitclone
    --output-dir output/auto-batch-multi-gpu-gitclone
    --devices 4
    --strategy ddp

# Environment variables
env:
  - WANDB_PROJECT=taco
  - PYTHONUNBUFFERED=1

# Resources
resources:
  gpu: 4
  memory: 60GB
  disk: 100GB

# Optional ports
ports:
  - 6006  # TensorBoard
